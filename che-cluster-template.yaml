spec:
  networking:
    auth:
      identityProviderURL: "https://sts.windows.net/$AZURE_TENANT_ID/v2.0/"
      identityToken: access_token
      oAuthClientName: $AZURE_CLIENT_ID
      oAuthSecret: $AZURE_CLIENT_SECRET
      oAuthScope: openid offline_access email profile 6dae42f8-4368-4678-94ff-3960e28e3630/user.read
      gateway:
        oAuthProxy:
          cookieExpireSeconds: 300
        deployment:
          containers:
            - env:
                - name: OAUTH2_PROXY_INSECURE_OIDC_ALLOW_UNVERIFIED_EMAIL
                  value: "true"
                - name: OAUTH2_PROXY_COOKIE_REFRESH
                  value: "2m"
                - name: OAUTH2_PROXY_SESSION_STORE_TYPE
                  value: redis
                - name: OAUTH2_PROXY_REDIS_CONNECTION_URL
                  value: redis://redis:6379/0
              name: oauth-proxy
  components:
    cheServer:
      extraProperties:
        CHE_OIDC_AUTH__SERVER__URL: "https://sts.windows.net/$AZURE_TENANT_ID/v2.0/"
        CHE_OIDC_EMAIL__CLAIM: unique_name
